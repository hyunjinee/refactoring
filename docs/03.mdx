---
sidebar_position: 3
---

# 3장 코드에서 나는 악취

추리 소설이라면 무슨 일이 전개되는지 궁금증을 자아낼수록 좋지만, 코드는 아니다.
코드는 단순하고 명료하게 작성해야 한다.  
코드를 명료하게 표현하는데 가장 중요한 요소 하나는 바로 이름이다.  
함수, 모듈, 변수, 클래스등은 그 이름만 보고도 각각이 무슨일을 하고 어떻게 새용해야 하는지 명확히 알 수 있도록 엄청나게 신경써서 이름을 지어야한다.  
마땅한 이름이 떠오르지 않는다면 설계에 더 근본적인 문제가 있을 가능성이 높다.  
혼란스러운 이름을 잘 정리하다보면 코드가 훨씬 간결해질 때가 많다.

## 중복 코드

똑같은 코드 구조가 여러 곳에서 반복된다면 하나로 통합하여 더 나은 프로그램을 작성할 수 있다.  
그중 하나를 변경할 때는 다른 비슷한 코드들도 모두 살펴보고 적절히 수정해야 한다.

## 긴 함수

우리의 경험에 비춰보면 오랜 기간 잘 활용되는 프로그램들은 하나같이 짧은 함수로 구성된다.  
짧은 함수들로 구성된 코드 베이스를 얼핏 훑으면 연산하는 부분이 하나도 없어 보인다.  
코드가 끝없이 위임하는 방식으로 작성되어 있기 때문이다. 하지만 이런 프로그램을 수년간 다루다보면 이 짧은 함수들이 얼마나 중요한지 깨닫게 된다.  
간접 호출(indirection)의 효과, 즉 코드를 이해하고, 공유하고, 선택하기 쉬워진다는 장점은 함수를 짧게 구성할 때 나오는 것이다.

짧은 함수로 구성된 코드를 이해하기 쉽게 만드는 가장 확실한 방법은 좋은 이름이다.
함수 이름을 잘 지어두면 본문 코드를 볼 이유가 사라진다.

함수 이름은 동작 방식이 아닌 의도가 드러나게 짓는다.  
이렇게 함수로 묶는 코드는 여러 줄일 수도 있고 단 한 줄일 수도 있다.
심지어 원래코드보다 길어지더라도 함수로 뽑는다.

함수의 이름에는 코드의 목적을 드러내야 한다. 즉 무엇을 하는지를 코드가 설명해주지 못할수록 함수로 만드는게 유리하다.

함수를 짧게 만든느 작업의 99%는 함수 추출하기가 차지한다. 함수 본문에서 따로 묶어서 빼내면 좋은 코드 덩어리를 찾아 새로운 함수로 만드는 것이다.

함수가 매개변수와 임시 변수를 많이 사용한다면 추출 작업에 방해가 된다. 이런 상황에서 함수를 추출하다보면 추출된 함수에도 매개변수가 많아져서 리팩터링 전보다 난해해질 수 있다.  
그렇다면 임시 변수를 질의 함수로 바꾸기로 임시 변수의 수를, 매개변수 객체만들기와 객체 통째로 넘기기로는 매개변수의 수를 줄일 수 있을 것 이다.

## 긴 매개변수 목록

종종 다른 매개변수에서 값을 얻어올 수 있는 매개변수가 있을 수 있는데, 이런 매개변수는 매개변수를 질의 함수로 바꾸기로 제거할 수 있다.  
사용중인 데이터 구조에서 값들을 뽑아 각각을 별개의 매개변수로 전달하는 코드라면 객체 통째로 넘기기를 적용해서 원본 데이터 구조를 그대로 전달한다.  
항상 함께 전달하는 매개변수들은 매개변수 객체로 만들기로 하나로 묶어버린다.

클래스는 매개변수 목록을 줄이는데 효과적인 수단이기도 하다.  
특히 여러개의 함수가 특정 매개변수들의 값을 공통으로 사용할 때 유용하다. 이럴 때는 여러 함수를 클래스로 묶기를 이용해 공통 값들을 클래스의 필드로 정의한다.  
함수형 프로그래밍이었다면 일련의 부분 적용 함수들을 생성한다고 말했을 것이다.

## 전역 데이터

전역 데이터의 대표적인 형태는 전역 변수지만 클래스 변수와 싱글톤에서도 같은 문제가 발생한다.
이런 데이터를 함수로 감싸는 것만으로도 데이터를 수정하는 부분을 쉽게 찾을 수 있고 접근을 통제할 수 있다. 더 나아가 접근자 함수들을 클래스나 모듈에 집어넣고 그 안에서만 사용할 수 있도록 접근 범위를 최소로 줄이는 것도 좋다.

전역 데이터가 가변이라면 특히나 다루기 까다롭다.  
프로그램이 구동된 후에는 값이 바뀌지 않는다고 보장할 수 있는 전역 데이터는 그나마 안전한 편이다. 물론 언어에서 이런 기능을 제공해야한다.

전역 데이터가 아주 조금만 있더라도 캡슐화하자. 그래야 소프트웨어가 진화하는데 따른 변화를 대처할 수 있다.

## 데이터 뭉치

데이터 항목들은 어린아이 같은 면이 있다. 서로 어울려 노는 것을 좋아한다.  
데이터 항목 서너 개가 여러곳에서 항상 함꼐 뭉쳐다니는 모습을 흔히 목격할 수 있다.  
이렇게 몰려다니는 데이터 뭉치는 보금자리를 따로 마련해줘야 마땅하다.

가장 먼저 필드 형태의 데이터 뭉치를 찾아서 클래스 추출하기로 하나의 객체로 묶는다.  
메서드 시그니처의 데이터 뭉치는 매개변수 객체만들기나 객체 통째로 넘기기를 적용해서 매개변수를 줄인다.

클래스를 이용하면 좋은 향기를 흩뿌릴 기회가 생긴다.  
기능 편애를 없애는 과정에서 새로운 클래스를 만들었다면, 이어서 그 클래스로 옮기면 좋을 동작은 없는지 살펴보자. 이러한 연계 과정은 종종 상당한 중복을 없애고 향후 개발을 가속하는 유용한 클래스를 탄생시키는 결과로 이어지기도 한다.

## 내부자 거래

소프트웨어 개발자는 모듈 사이에 벽을 두껍게 세우기를 좋아하며, 그래서 모듈 사이의 데이터 거래가 많으면 결합도가 높아진다고 투덜댄다.  
일이 돌아가게 하려면 거래가 이뤄질 수 밖에 없지만 그 양을 최소로 줄이고 모두 투명하게 처리해야한다.

여러 모듈이 같은 관심사를 공유한다면 공통 부분을 정식으로 처리하는 제 3의 모듈을 새로 만들거나 위임 숨기기를 이용하여 다른 모듈이 중간자 역할을 하게 만든다.

## 주석

주석이 장황하게 달린 원인이 코드를 잘못 작성했기 떄문인 경우가 의외로 많다.

주석을 남겨야겠다는 생각이 들면, 가장 먼저 주석이 필요 없는 코드로 리팩터링해본다.

뭘 할지 모를 때라면 주석을 달아두면 좋다. 현재 진행 상황뿐만 아니라 확실하지 않은 부분에 주석을 남긴다.  
코드를 지금처럼 작성한 이유를 설명하는 용도로 달 수도 있다.
이런 정보는 나중에 코드를 수정해야 할 프로그래머에게, 특히 건망증이 심한 프로그래머에게 도움될 것이다.
