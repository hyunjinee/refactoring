---
sidebar_position: 4
---

# 3장 테스트 구축하기

리팩터링은 분명 가치있는 도구이지만, 그것만으로는 부족하다.  
리팩터링을 제대로 하려면 불가피하게 저지르는 실수를 잡아주는 견고한 테스트 스위트가 뒷받침돼야 한다.

## 자가 테스트 코드의 가치

버그 수정 자체는 대체로 금방 끝난다.  
진짜 끔찍한 것은 버그를 찾는 여정이다.  
또한 버그를 잡는 과정에서 다른 버그를 심기도 하는데, 그 사실을 한참이 지나서야 알아채기도 한다. 그래서 또 다시 그 버글르 찾느라 수많은 시간을 날린다.

모든 테스트가 성공하면 화면에 OK만 출력하도록 만들었다. 이렇게 자가 테스트 소프트웨어가 탄생했다.

모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자.  
이렇게 하면 테스트가 컴파일만큼 쉬워진다. 그래서 다음부터는 컴파일 할 때마다 테스트 코드도 함께 했고, 곧바로 생산성이 급상승했다.  
디버깅 시간이 크게 줄어든 것이다.

이러한 테스트 코드를 몇분 간격으로 자주 수행했기 때문에 버그가 발생한 지점은 조금 전에 작성한 코드에 있다는 사실도 알 수 있었다.  
의심되는 코드의 양이 많지않고 아직 기억이 생생하니 버그를 쉽게 찾울 수 있었다.  
이렇게 하지 않았다면 몇 시간이 걸렸을지 모를 버그를 단 몇분이면 해결할 수 있었다.

이처럼 자가 테스트 코드 자체뿐 아니라 테스트를 자주 수행하는 습관도 버그를 찾는 강력한 도구가 된다.

테스트를 작성하려면 소프트웨어 제품 본체 외에 부가적인 코드를 상당량 작성해야한다.  
그래서 테스트가 실제로 프로그래밍 속도를 높여주는 경험을 직접 해보지 않고서는 자가 테스트의 진가를 납득하기 어렵다.  
테스트를 자동화한다면 테스트를 작성하는 재미가 꽤 쏠쏠하다.

테스트를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전이다.  
기능을 추가해야할 때 테스트 부터 작성한다. 얼핏 순서가 뒤바뀐 듯 들리지만, 전혀 그렇지 않다.  
테스트를 작성하다보면 원하는 기능을 추가하기 위해 무엇이 필요한지 고민하게 된다.

**구현보다 인터페이스에 집중하게 된다는 장점이 있다. (무조건 좋은 일이다.)**
게다가 코딩이 완료되는 시점을 정확하게 판단할 수 있다. 테스트를 모두 통과한 시점이 바로 코드를 완성한 시점이된다.

켄트 벡은 이처럼 테스트부터 작성하는 습관을 바탕으로 테스트 주도 개발(TDD)이란 기법을 창시했다.  
TDD에서는 처음에 통과하지 못할 테스트를 작성하고, 이 테스트를 통과하게끔 코드를 작성하고, 결과 코드를 최대한 깔끔하게 리팩터링하는 과정을 짧은 주기로 반복한다.

이렇게 테스트-코딩-리팩터링 과정을 한시간에도 여러차례 진행하기 때문에 코드를 대단히 생산적이면서도 차분하게 작성할 수 있다.

리팩터링에는 테스트가 필요합니다. 그러니 리팩터링하고 싶다면 테스트를 반드시 작성해야합니다.

코드를 작성할 때 테스트 코드도 동시에 작성한다.  
테스트가 갖춰지지 않은 코드를 리팩터링해야할 때 곧바로 리팩터링하지 않고, 먼저 자가 테스트 코드부터 작성합니다.

## 첫 번째 테스트

테스트 it 블록에 남긴다.
describe 블록과 it블록에 부연 설명용 문자열을 써넣는 방식은 개발자마다 다르다.
테스트가 무엇을 검사하는지 설명해 넣는 사람이 있는 반면 마치 명확한 코드에는 주석이 필요 없는 것과 같은 맥락에서 이공간을 그냥 비워두는 사람이 있다.

실패해야 할 상황에서는 반드시 실패하게 만들자.
자주 테스트하라. 작성중인 코드는 최소한 몇분 간격으로 테스트하고, 적어도 하루에 한번은 전체 테스트를 돌려보자.

완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는게 낫다.

일반적으로 it 구문하나당 검증도 하나씩만 하는게 좋다. 앞쪽 검증을 통과하지 못하면 나머지 검증은 실행해보지도 못하고 테스트가 실패하게 되는데 그러면 실패 원인을 파악하는데 유용한 정보를 놓치기 쉽기 때문이다.

## 경계 조건 검사하기

문제가 생길 가능성이 있는 경계조건을 생각해보고 그 부분을 집중적으로 테스트하자.
의식적으로 프로그램을 망가뜨리는 방법을 모색한다. 이런 마음 자세가 생산성과 재미를 끌어올려준다.

어차피 모든 버그를 잡아낼 수는 없다고 생각하여 테스트를 작성하지 않는다면 대다수의 버그를 잡을 기회를 날리는 셈이다.

테스트를 어느 수준까지 해야할까? 아무리 테스트해도 버그없는 완벽한 프로그램을 만들 수 없다는 말은 많이 들어봤을 것이다.  
맞는 말이지만, 테스트가 프로그래밍 속도를 높여준다는 사실에는 변함이 없다.

단위 테스트란 코드의 작은 영역만을 대상으로 빠르게 실행되도록 설계된 테스트이다.  
단위 테스트는 자가 테스트 코드의 핵심이자, 자가 테스트 시스템은 대부분 단위 테스트가 차지한다.

물론 컴포넌트 사이의 상호작용에 집중하는 테스트나, 소프트웨어의 다양한 계층의 연동을 검사하는 테스트, 성능 문제를 다루는 테스트 등 다양한 유형의 테스트가 있다. (테스트 유형도 많지만, 유형을 분류하는 방식에 대한 논쟁은 그보다 더 많다.)

버그를 발견하는 즉시 발견한 버그를 명확히 잡아내는 테스트부터 작성하는 습관을 들이자. 아주 중요한 습관이다.  
버그를 고치기 전에 항상 이런 테스트부터 만듦녀 해당 버그가 다시 나타나지 않는지 확인할 수 있다.

또한 그 버그와 테스트를 계기로 테스트 스위트에 또 다른 구멍은 없는지 살펴본다.  
버그 리포트를 받으면 가장 먼저 그 버그를 드러내는 단위 테스트부터 작성하자.

**리팩터링 후 테스트 결과가 모두 초록색인것만을 보고도 리팩터링 과정에서 생겨난 버그가 하나도 없다고 확신할 수 있다면 충분히 좋은 테스트 스위트라고 할 수 있다.**  
테스트를 너무 많이 작성할 가능성도 있다. 제품 코드보다 테스트 코드를 수정하는데 시간이 더 걸린다면, 그리고 테스트 때문에 개발 속도가 느려진다고 생각되면 테스트를 과하게 작성한건 아닌지 의심해보자.  
하지만 너무 많은 경우보다는 너무 적은 경우가 훨씬 많다.
